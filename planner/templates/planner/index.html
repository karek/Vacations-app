{% extends "planner/base.html" %}

{% load staticfiles %}

{% block content %}
<div class="row">
    <div class="col-lg-9">
        <div id='calendar'></div>
    </div>
    <div class="col-lg-3">
        <h2 style="margin-top: 0px;" align="center">Selected absence</h2>
        <form id='plan-absence' method='POST' action="{% url 'planner:plan-absence' %}">
            {% csrf_token %}
            <div id='absence_select' class="list-group" style="padding-top: 9px">
            </div>
            <div class="form-actions"  style="text-align: center;">
                {% if request.user.is_authenticated %}
                <input type='submit' name='book-value-submit' value='Plan Absence' class='btn btn-primary'/>
                {% else %}
                <p>You have to be logged in to plan absences.</p>
                {% endif %}
            </div>
        </form>
    </div>
</div>

{% comment %} TODO: remove this when we no longer need such debug output. {% endcomment %}
<div>
    <h3> Currently booked: </h3>
    <ul id='all_ranges'>
    </ul>
</div>


{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="{% static 'planner/js/moment.min.js' %}"></script>
<script src="{% static 'planner/js/fullcalendar.js' %}"></script>
<script src="{% static 'planner/js/selection.js' %}"></script>
<script src="{% static 'planner/js/ajaxes.js' %}"></script>
<script type="text/javascript">
    global_user_url = {% url 'planner:user' %};
    global_range_url = {% url 'planner:range' %};
    {% if request.user.is_authenticated %}
        global_logged_user_id = {{ request.user.id }};
        global_logged_user_name = "{{ request.user.first_name }}" + " " + "{{ request.user.last_name }}";
    {% else %}
        global_logged_user_id = -1;
        global_logged_user_name = "";
    {% endif %}
    {% autoescape off %}
    saveUserData({{ users }});
    {% endautoescape %}
</script>
{% endblock %}

{% block calendarDeclaration %}
    <script type="text/javascript">
    $(document).ready(function() {
        $('#calendar').fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,weekWorkers'
            },
            eventLimit: 5,
{#            views: {#}
{#                agenda: {#}
{#                    eventLimit: 5 // adjust to 6 only for agendaWeek/agendaDay#}
{#                }#}
{#            },#}
            defaultView: 'weekWorkers', //TODO: Remove
            selectable: true,  // we can select days
            selectHelper: true, // we see our selection
            unselectAuto: false, // no autoclearing selection after clickng on page(not enough though)
            unSelectCancel: '.fc-day',
            select: selectf, // our function for select
            unselect: unselectf, // our function for clearing selection
//            selectOverlap: check_select_overlap, // function for checking where selections can be made
            events: {
                events: getAbsencesForCalendar
            },
            viewRender: view_render_callback
        });
    });
</script>
{% endblock %}
